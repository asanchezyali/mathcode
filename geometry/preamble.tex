% preamble.tex - Contains all packages and configurations
\documentclass[12pt, a4paper, oneside]{book}
%%% BASIC PACKAGES
\usepackage[T1]{fontenc}        
\usepackage[utf8]{inputenc}    
\usepackage{lmodern}
\usepackage[spanish, es-noshorthands]{babel}
\usepackage{comment}
\usepackage{textcomp}

%%% DOCUMENT GEOMETRY
\usepackage[top=2.5cm, bottom=2.5cm, right=2.5cm, left=2.5cm, headheight=15pt, marginparwidth=2.5cm]{geometry}
\usepackage{multicol}
\usepackage{lscape}

%%% MATH PACKAGES
\usepackage{amsmath, amsthm, amsfonts, latexsym, cancel}
\usepackage{amsbsy}
\usepackage{thmtools}
\usepackage{amssymb}
\usepackage{mathtools}


%%% STYLE AND DESIGN PACKAGES
\usepackage[dvipsnames]{xcolor}
\usepackage{tikz}
\usetikzlibrary{calc,shapes,shadows,decorations.pathmorphing,matrix,positioning}
\usepackage{tikz-qtree}  % For tree diagrams (\Tree command)
\usepackage{mdframed}

%%% CODE LISTINGS
\usepackage{listings}

% Modern code color palette
\definecolor{codeBackground}{RGB}{250, 250, 252}      % Very soft lavender-gray
\definecolor{codeFrame}{RGB}{218, 220, 235}           % Subtle purple-gray border
\definecolor{codeAccent}{RGB}{99, 102, 241}           % Indigo accent for left bar
\definecolor{codeKeyword}{RGB}{124, 58, 237}          % Purple for keywords
\definecolor{codeString}{RGB}{5, 150, 105}            % Emerald for strings
\definecolor{codeComment}{RGB}{148, 163, 184}         % Slate gray for comments
\definecolor{codeNumber}{RGB}{180, 190, 205}          % Soft gray for line numbers
\definecolor{codeFunction}{RGB}{37, 99, 235}          % Blue for functions
\definecolor{codeVariable}{RGB}{217, 70, 239}         % Fuchsia for special

\lstset{
    % Typography
    basicstyle=\ttfamily\small\linespread{1.1}\selectfont,
    keywordstyle=\color{codeKeyword}\bfseries,
    keywordstyle=[2]\color{codeFunction},
    commentstyle=\color{codeComment}\itshape,
    stringstyle=\color{codeString},
    % Line numbers
    numbers=left,
    numberstyle=\scriptsize\color{codeNumber}\ttfamily,
    numbersep=12pt,
    % Frame and background
    frame=l,
    framesep=8pt,
    framerule=2.5pt,
    rulecolor=\color{codeAccent},
    backgroundcolor=\color{codeBackground},
    % Spacing
    xleftmargin=18pt,
    xrightmargin=8pt,
    aboveskip=14pt,
    belowskip=10pt,
    % Behavior
    breaklines=true,
    breakatwhitespace=true,
    captionpos=b,
    showstringspaces=false,
    tabsize=4,
    % Extra settings
    extendedchars=true,
    inputencoding=utf8,
    literate={á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1
             {ñ}{{\~n}}1 {Á}{{\'A}}1 {É}{{\'E}}1 {Í}{{\'I}}1 {Ó}{{\'O}}1
             {Ú}{{\'U}}1 {Ñ}{{\~N}}1
}

%%% BOOK-SPECIFIC PACKAGES
\usepackage{fancyhdr}
\usepackage{booktabs}
\usepackage{minitoc}  % Mini table of contents at start of chapters
\usepackage{epigraph} % For chapter epigraphs/quotes
\usepackage{titlesec} % Custom chapter and section formatting

%%% BIBLIOGRAPHY AND REFERENCES
\usepackage[backend=biber, style=apa, sorting=ynt]{biblatex}
\usepackage{csquotes}  % Required for biblatex

%%% INDEX AND GLOSSARY
\usepackage{imakeidx}
\usepackage[toc]{glossaries}
\makeindex[columns=3, title=Índice Alfabético]

%%% GRAPHICS AND FIGURES
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}
\graphicspath{{./images/}}

%%% HYPERLINKS
\usepackage[
	breaklinks=true, 
	colorlinks=true, 
	linkcolor=blue,
	citecolor=blue, 
	urlcolor=gray
]{hyperref}
\usepackage{xurl} % Break URLs

%%% COLOR DEFINITIONS
\definecolor{theoremBG}{RGB}{235,245,255}        % Fondo teorema más intenso
\definecolor{theoremBorder}{RGB}{210,225,250}    % Borde teorema más intenso
\definecolor{definitionBG}{RGB}{235,255,240}     % Fondo definición más intenso
\definecolor{definitionBorder}{RGB}{210,245,220} % Borde definición más intenso
\definecolor{remarkBG}{RGB}{255,240,230}         % Fondo observación más intenso
\definecolor{remarkBorder}{RGB}{250,220,205}     % Borde observación más intenso
\definecolor{easyBG}{RGB}{230,242,255}           % Fondo problema fácil más intenso
\definecolor{easyBorder}{RGB}{205,220,250}       % Borde problema fácil más intenso
\definecolor{mediumBG}{RGB}{255,240,225}         % Fondo problema medio más intenso
\definecolor{mediumBorder}{RGB}{250,220,205}     % Borde problema medio más intenso
\definecolor{hardBG}{RGB}{255,230,240}           % Fondo problema difícil más intenso
\definecolor{hardBorder}{RGB}{250,205,220}       % Borde problema difícil más intenso
\definecolor{exerciseBG}{RGB}{240,240,255}       % Fondo ejercicio más intenso
\definecolor{exerciseBorder}{RGB}{220,220,250}   % Borde ejercicio más intenso

%%% THEOREM STYLES
\mdfdefinestyle{theoremstyle}{
    linecolor=theoremBorder,
    linewidth=0.4pt,                
    backgroundcolor=theoremBG!40,  
    innertopmargin=10pt,
    innerbottommargin=10pt,
    innerleftmargin=10pt,
    innerrightmargin=10pt,
    skipabove=\topskip,
    skipbelow=\topskip,
}

\mdfdefinestyle{definitionstyle}{
    linecolor=definitionBorder,
    linewidth=0.4pt,
    backgroundcolor=definitionBG!40,
    innertopmargin=10pt,
    innerbottommargin=10pt,
    innerleftmargin=10pt,
    innerrightmargin=10pt,
    skipabove=\topskip,
    skipbelow=\topskip,
}

\mdfdefinestyle{remarkstyle}{
    linecolor=remarkBorder,
    linewidth=0.4pt,
    backgroundcolor=remarkBG!40,
    innertopmargin=10pt,
    innerbottommargin=10pt,
    innerleftmargin=10pt,
    innerrightmargin=10pt,
    skipabove=\topskip,
    skipbelow=\topskip,
}

\mdfdefinestyle{easyproblemstyle}{
    linecolor=easyBorder,
    linewidth=0.4pt,
    backgroundcolor=easyBG!40,
    innertopmargin=10pt,
    innerbottommargin=10pt,
    innerleftmargin=10pt,
    innerrightmargin=10pt,
    skipabove=\topskip,
    skipbelow=\topskip,
}

\mdfdefinestyle{mediumproblemstyle}{
    linecolor=mediumBorder,
    linewidth=0.4pt,
    backgroundcolor=mediumBG!40,
    innertopmargin=10pt,
    innerbottommargin=10pt,
    innerleftmargin=10pt,
    innerrightmargin=10pt,
    skipabove=\topskip,
    skipbelow=\topskip,
}

\mdfdefinestyle{hardproblemstyle}{
    linecolor=hardBorder,
    linewidth=0.4pt,
    backgroundcolor=hardBG!40,
    innertopmargin=10pt,
    innerbottommargin=10pt,
    innerleftmargin=10pt,
    innerrightmargin=10pt,
    skipabove=\topskip,
    skipbelow=\topskip,
}

\mdfdefinestyle{exercisestyle}{
    linecolor=exerciseBorder,
    linewidth=0.4pt,
    backgroundcolor=exerciseBG!40,
    innertopmargin=10pt,
    innerbottommargin=10pt,
    innerleftmargin=10pt,
    innerrightmargin=10pt,
    skipabove=\topskip,
    skipbelow=\topskip,
}

%%% THEOREM DEFINITIONS
\newtheorem{theorem}{Teorema}[chapter] % Changed from [section] to [chapter]
\newtheorem{corollary}{Corolario}[theorem]
\newtheorem{lemma}[theorem]{Lema}

\theoremstyle{definition}
\newtheorem{definition}{Definición}[chapter] % Changed from [section] to [chapter]

\theoremstyle{remark}
\newtheorem*{remark}{Observación}

\newtheorem{example}{Ejemplo}[chapter] % Changed from [section] to [chapter]
\newtheorem{easyproblem}{Problema}[chapter] % Changed from [section] to [chapter]
\newtheorem{mediumproblem}{Problema}[chapter] % Changed from [section] to [chapter]
\newtheorem{hardproblem}{Problema}[chapter] % Changed from [section] to [chapter]
\newtheorem{exercise}{Ejercicio}[chapter] % Changed from [section] to [chapter]

%%% APPLY STYLES TO THEOREMS
\surroundwithmdframed[style=theoremstyle]{theorem}
\surroundwithmdframed[style=theoremstyle]{corollary}
\surroundwithmdframed[style=theoremstyle]{lemma}
\surroundwithmdframed[style=definitionstyle]{definition}
\surroundwithmdframed[style=remarkstyle]{remark}
\surroundwithmdframed[style=theoremstyle]{example}
\surroundwithmdframed[style=easyproblemstyle]{easyproblem}
\surroundwithmdframed[style=mediumproblemstyle]{mediumproblem}
\surroundwithmdframed[style=hardproblemstyle]{hardproblem}
\surroundwithmdframed[style=exercisestyle]{exercise}

%%% PROOF STYLE
\renewenvironment{proof}[1][\proofname]
    {\par\noindent\textit{#1.}\space}
    {\hfill$\square$\par\vspace{\baselineskip}}

%%% CUSTOM CHAPTER FORMATTING
\titleformat{\chapter}[display]
  {\normalfont\huge\bfseries}
  {\chaptertitlename\ \thechapter}
  {20pt}
  {\Huge}
\titlespacing*{\chapter}{0pt}{50pt}{40pt}

%%% CUSTOM SECTION FORMATTING
\titleformat{\section}
  {\normalfont\Large\bfseries}
  {\thesection}
  {1em}
  {}
\titlespacing*{\section}{0pt}{3.5ex plus 1ex minus .2ex}{2.3ex plus .2ex}

%%% HEADER AND FOOTER SETTINGS
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\chaptermark}[1]{\markboth{\chaptername\ \thechapter.\ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{\thesection.\ #1}}
\fancyhead[LE,RO]{\thepage}
\fancyhead[LO]{\textit{\rightmark}}
\fancyhead[RE]{\textit{\leftmark}}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}

%%% MATH OPERATORS
\DeclareMathOperator{\sen}{sen\,} %Función seno.
\DeclareMathOperator{\senh}{senh\,} %Función seno hiperbólico.
\DeclareMathOperator{\sech}{sech\,} %Función secante hiperbólico.
\DeclareMathOperator{\rot}{rot\,} %Rotacional.
\DeclareMathOperator{\dive}{div\,} %Divergencia.
\DeclareMathOperator{\nulo}{nul\,} %Nulo.
\DeclareMathOperator{\im}{img} %Imagen.
\DeclareMathOperator{\id}{id} %Función identidad.
\DeclareMathOperator{\Tr}{Tr\,} %Traza. 
\DeclareMathOperator{\Crit}{Crit\,} %Cunjunto de puntos críticos.
\DeclareMathOperator{\md}{\;mod} %Modulo.
\DeclareMathOperator{\ord}{ord} %Orden.
\DeclareMathOperator{\mcd}{mcd} %Máximo común divisor.
\DeclareMathOperator{\mcm}{mcm} %Mínimo común múltiplo

%%% MATH SYMBOLS AND COMMANDS
\newcommand{\KK}{\mathbb{K}} %Un cuerpo cualquiera.
\newcommand{\EE}{\mathcal{E}} %Espacio euclidiano.
\newcommand{\FF}{\mathbb{F}} %Campo comutativo.
\newcommand{\HH}{\mathbb{H}} %Semiespacio real superior.
\newcommand{\RR}{\mathbb{R}} %Números Reales.
\newcommand{\ZZ}{\mathbb{Z}} %Número Enteros.
\newcommand{\NN}{\mathbb{N}} %Numero Natureles.
\newcommand{\NNO}{\mathbb{N}_{_0}} %Numero Natureles.
\newcommand{\QQ}{\mathbb{Q}} %Números Racionales.
\newcommand{\CC}{\mathbb{C}} %Números Complejos

%%% PARAGRAPH SETTINGS
\setlength{\parindent}{0cm}
\setlength{\parskip}{2mm}

%%% ORPHANS AND WIDOWS PREVENTION
\clubpenalty=1000
\widowpenalty=1000
\displaywidowpenalty=1000

% --- Custom commands for title page ---
\makeatletter
\newcommand{\printbooktitle}{\@title}
\newcommand{\printbookauthor}{\@author}
\newcommand{\printbookdate}{\@date}
\makeatother
\let\cleardoublepage\clearpage
\addbibresource{bibliography/references.bib}
